<head>
    <title>Dashboard - TimeManager</title>  
    <link rel="stylesheet" href="/css/dashboard.css">
</head>

<div class="dashboard-container">
    <!-- Welcome Banner -->
    <div class="welcome-banner">
        <h1>Welcome to Your Dashboard</h1>
        <p class="current-date"><%= new Date().toLocaleDateString('en-US', {weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'}) %></p>
    </div>
    
    <!-- Status Summary Row with improved spacing -->
    <div class="summary-section">
        <!-- Today's Status Card -->
        <div class="summary-card status-card">
            <h3><i class="fas fa-user-clock"></i> Today's Status</h3>
            <div id="status-content">
                <% if (activeEntry) { %>
                    <div class="status-item">
                        <span class="status-label">Clock In:</span>
                        <span class="status-value"><%= activeEntry.login %></span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Remaining Time:</span>
                        <span class="status-value"><%= remainingHours %> hours</span>
                    </div>
                    <% if (activeEntry.pauseStart) { %>
                        <div class="status-item">
                            <span class="status-label">Status:</span>
                            <span class="status-value status-break">On Break</span>
                        </div>
                    <% } else if (activeEntry.unavailableStart) { %>
                        <div class="status-item">
                            <span class="status-label">Status:</span>
                            <span class="status-value status-unavailable">Unavailable</span>
                        </div>
                    <% } else { %>
                        <div class="status-item">
                            <span class="status-label">Status:</span>
                            <span class="status-value status-active">Active</span>
                        </div>
                    <% } %>
                    <a href="/timesheet" class="btn btn-primary">View Timesheet</a>
                <% } else { %>
                    <p class="no-active">You haven't clocked in today</p>
                    <button id="clockInBtn" class="btn btn-success">Clock In Now</button>
                    <div id="clock-in-message" class="message-container"></div>
                <% } %>
            </div>
        </div>
        
        <!-- Leave Balance Card -->
        <div class="summary-card leave-card">
            <h3><i class="fas fa-calendar-alt"></i> Leave Balance</h3>
            <div class="progress-container">
                <div class="progress-bar" style="width: 60%"></div>
            </div>
            <p class="leave-balance-text">15 days used out of 25</p>
            <a href="/apply-leave" class="btn btn-outline">View Details</a>
        </div>
    </div>
    
    <!-- Recent Time Entries with improved margin -->
    <div class="recent-entries-section">
        <h2><i class="fas fa-history"></i> Recent Time Entries</h2>
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Clock In</th>
                        <th>Clock Out</th>
                        <th>Break</th>
                        <th>Total Hours</th>
                    </tr>
                </thead>
                <tbody>
                    <% if (typeof recentEntries !== 'undefined' && recentEntries && recentEntries.length > 0) { %>
                        <% recentEntries.forEach(entry => { %>
                            <tr>
                                <td><%= entry.date %></td>
                                <td><%= entry.login %></td>
                                <td><%= entry.logout || '---' %></td>
                                <td><%= entry.pause %></td>
                                <td><%= entry.totalAvailable %></td>
                            </tr>
                        <% }); %>
                    <% } else { %>
                        <tr>
                            <td colspan="5" class="text-center">No recent entries found</td>
                        </tr>
                    <% } %>
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Quick Actions -->
    <div class="quick-actions">
        <h2><i class="fas fa-bolt"></i> Quick Actions</h2>
        <div class="action-cards">
            <div class="action-card">
                <div class="card-icon"><i class="fas fa-clock"></i></div>
                <h3>Time Tracking</h3>
                <p>Manage your work hours and breaks</p>
                <a href="/timesheet" class="btn btn-primary">Go to Timesheet</a>
            </div>
            
            <div class="action-card">
                <div class="card-icon"><i class="fas fa-calendar-alt"></i></div>
                <h3>Leave Management</h3>
                <p>Apply for leaves and check your balance</p>
                <a href="/apply-leave" class="btn btn-secondary">Apply Leave</a>
            </div>
            
            <div class="action-card">
                <div class="card-icon"><i class="fas fa-chart-line"></i></div>
                <h3>Reports</h3>
                <p>View your productivity metrics</p>
                <a href="#" class="btn btn-tertiary">View Reports</a>
            </div>
        </div>
    </div>
</div>

<!-- Dashboard Scripts -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const clockInBtn = document.getElementById('clockInBtn');
    const messageContainer = document.getElementById('clock-in-message');
    
    if (clockInBtn) {
        clockInBtn.addEventListener('click', async function() {
            try {
                // Disable button and show loading state
                clockInBtn.disabled = true;
                clockInBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
                
                const response = await fetch('/api/clock-in', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    showMessage('success', 'Successfully clocked in! Redirecting to timesheet...');
                    setTimeout(() => {
                        window.location.href = '/timesheet';
                    }, 1500);
                } else {
                    const data = await response.json();
                    showMessage('error', `Error: ${data.error}`);
                    // Re-enable button
                    clockInBtn.disabled = false;
                    clockInBtn.innerHTML = 'Clock In Now';
                }
            } catch (error) {
                console.error('Error:', error);
                showMessage('error', 'An unexpected error occurred. Please try again.');
                // Re-enable button
                clockInBtn.disabled = false;
                clockInBtn.innerHTML = 'Clock In Now';
            }
        });
    }
    
    // Helper function to show messages
    function showMessage(type, message) {
        if (messageContainer) {
            messageContainer.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            // Auto-hide success messages after 5 seconds
            if (type === 'success') {
                setTimeout(() => {
                    messageContainer.innerHTML = '';
                }, 5000);
            }
        }
    }
});
</script>

<!-- Add this to your CSS file or in a style tag -->
<style>
.message-container {
    margin-top: 15px;
}

.alert {
    padding: 10px;
    border-radius: 4px;
    margin-bottom: 15px;
}

.alert-success {
    background-color: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.alert-error {
    background-color: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

.status-break {
    color: #fd7e14;
}

.status-unavailable {
    color: #6c757d;
}

.status-active {
    color: #28a745;
}

.table-responsive {
    overflow-x: auto;
    margin-bottom: 2rem;
}

.recent-entries-section {
    margin: 2rem 0;
}

.recent-entries-section h2 {
    margin-bottom: 1rem;
}
</style>